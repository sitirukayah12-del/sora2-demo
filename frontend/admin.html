<!DOCTYPE html>
<html lang="zh">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>åå°ç®¡ç† - AI Creative Studio</title>
    <link rel="stylesheet" href="/static/style.css">
    <style>
        /* Admin specific styles overriding or extending style.css */
        
        /* Table Styles */
        .admin-table {
            width: 100%;
            border-collapse: collapse;
            margin-top: 20px;
        }
        
        .admin-table th, .admin-table td {
            text-align: left;
            padding: 12px 16px;
            border-bottom: 1px solid var(--border-color);
        }
        
        .admin-table th {
            font-weight: 600;
            color: var(--text-light);
            background-color: #f8fafc;
        }
        
        .admin-table tr:hover {
            background-color: #f1f5f9;
        }
        
        /* Action Buttons */
        .btn-small {
            padding: 6px 12px;
            font-size: 0.9rem;
            border-radius: 6px;
        }

        /* Pricing Grid */
        .pricing-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 20px;
            margin-top: 20px;
        }

        .pricing-card {
            background: #f8fafc;
            border: 1px solid var(--border-color);
            border-radius: 16px;
            padding: 20px;
            transition: all 0.2s;
        }

        .pricing-card:hover {
            border-color: #ff4757;
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(255, 71, 87, 0.1);
        }

        .pricing-icon {
            font-size: 2rem;
            margin-bottom: 1rem;
            display: block;
        }

        .pricing-input-group {
            margin-top: 15px;
        }
        
        .pricing-input-group label {
            display: block;
            font-size: 0.85rem;
            color: var(--text-light);
            margin-bottom: 5px;
        }
    </style>
</head>
<body>
    <div class="app-container">
        <!-- Navigation -->
        <nav class="navbar">
            <div class="logo">ğŸ›¡ï¸ Admin</div>
            <div class="nav-links">
                <div class="nav-item active" onclick="switchTab('users')">ç”¨æˆ·ç®¡ç†</div>
                <div class="nav-item" onclick="switchTab('pricing')">ä»·æ ¼é…ç½®</div>
                <div class="nav-item" onclick="switchTab('templates')">æç¤ºè¯æ¨¡æ¿</div>
                <div class="nav-item" onclick="switchTab('api')">API è®¾ç½®</div>
            </div>
            <div class="nav-auth">
                <button class="btn-auth" onclick="logout()">é€€å‡ºç™»å½•</button>
            </div>
        </nav>

        <!-- Main Content -->
        <div class="content-wrapper">
            
            <!-- Users Tab -->
            <div id="tab-users" class="tab-content active">
                <div class="hero-text" style="text-align: left; margin-bottom: 2rem;">
                    <h1>ç”¨æˆ·ç®¡ç†</h1>
                    <p>æŸ¥çœ‹ç”¨æˆ·åˆ—è¡¨åŠç®¡ç†ç”¨æˆ·ä½™é¢ã€‚</p>
                </div>
                
                <div style="display: flex; justify-content: flex-end; margin-bottom: 1rem;">
                    <button class="secondary-btn" onclick="loadUsers()">ğŸ”„ åˆ·æ–°åˆ—è¡¨</button>
                </div>

                <div style="overflow-x: auto;">
                    <table class="admin-table">
                        <thead>
                            <tr>
                                <th>ID</th>
                                <th>ç”¨æˆ·å</th>
                                <th>é‚®ç®±</th>
                                <th>ä½™é¢ (Credits)</th>
                                <th>çŠ¶æ€</th>
                                <th>æ“ä½œ</th>
                            </tr>
                        </thead>
                        <tbody id="users-list">
                            <!-- Users injected here -->
                        </tbody>
                    </table>
                </div>
            </div>

            <!-- Pricing Tab -->
            <div id="tab-pricing" class="tab-content">
                <div class="hero-text" style="text-align: left; margin-bottom: 2rem;">
                    <h1>ä»·æ ¼é…ç½®</h1>
                    <p>è®¾ç½®å„é¡¹ç”ŸæˆæœåŠ¡çš„å•æ¬¡æ¶ˆè€—ç®—åŠ›ã€‚</p>
                </div>

                <div class="pricing-grid">
                    <div class="pricing-card">
                        <span class="pricing-icon">ğŸ¥</span>
                        <h3>è§†é¢‘ç”Ÿæˆ</h3>
                        <div class="pricing-input-group">
                            <label>å•æ¬¡æ¶ˆè€— (Credits)</label>
                            <input type="number" id="price-video" step="0.1" placeholder="0.0">
                        </div>
                    </div>

                    <div class="pricing-card">
                        <span class="pricing-icon">ğŸ–¼ï¸</span>
                        <h3>å›¾ç‰‡ç”Ÿæˆ</h3>
                        <div class="pricing-input-group">
                            <label>å•æ¬¡æ¶ˆè€— (Credits)</label>
                            <input type="number" id="price-image" step="0.1" placeholder="0.0">
                        </div>
                    </div>

                    <div class="pricing-card">
                        <span class="pricing-icon">ğŸµ</span>
                        <h3>éŸ³ä¹ç”Ÿæˆ</h3>
                        <div class="pricing-input-group">
                            <label>å•æ¬¡æ¶ˆè€— (Credits)</label>
                            <input type="number" id="price-music" step="0.1" placeholder="0.0">
                        </div>
                    </div>

                    <div class="pricing-card">
                        <span class="pricing-icon">ğŸ‘¤</span>
                        <h3>æ•°å­—äºº</h3>
                        <div class="pricing-input-group">
                            <label>å•æ¬¡æ¶ˆè€— (Credits)</label>
                            <input type="number" id="price-avatar" step="0.1" placeholder="0.0">
                        </div>
                    </div>
                </div>

                <div style="margin-top: 2rem; text-align: right;">
                    <button class="primary-btn" style="width: auto;" onclick="savePricing()">ğŸ’¾ ä¿å­˜ä»·æ ¼é…ç½®</button>
                </div>
            </div>

            <!-- Templates Tab -->
            <div id="tab-templates" class="tab-content">
                <div class="hero-text" style="text-align: left; margin-bottom: 2rem;">
                    <h1>æç¤ºè¯æ¨¡æ¿</h1>
                    <p>ç®¡ç†ç”Ÿæˆé¡µé¢çš„å¿«æ·æç¤ºè¯æ¨¡æ¿ã€‚</p>
                </div>

                <div style="display: flex; justify-content: flex-end; margin-bottom: 1rem;">
                    <button class="primary-btn" onclick="openTemplateModal()">+ æ–°å¢æ¨¡æ¿</button>
                </div>

                <div style="overflow-x: auto;">
                    <table class="admin-table">
                        <thead>
                            <tr>
                                <th>ID</th>
                                <th>åç§°</th>
                                <th>åˆ†ç±»</th>
                                <th>å†…å®¹ (é¢„è§ˆ)</th>
                                <th>çŠ¶æ€</th>
                                <th>æ“ä½œ</th>
                            </tr>
                        </thead>
                        <tbody id="templates-list">
                            <!-- Templates injected here -->
                        </tbody>
                    </table>
                </div>
            </div>

            <!-- API Tab -->
            <div id="tab-api" class="tab-content">
                <div class="hero-text" style="text-align: left; margin-bottom: 2rem;">
                    <h1>API è®¾ç½®</h1>
                    <p>é…ç½®åå°ç®¡ç†å¯†ç åŠç¬¬ä¸‰æ–¹æœåŠ¡å¯†é’¥ã€‚</p>
                </div>
                
                <div class="input-section">
                    <div class="form-group">
                        <label>ç®¡ç†å¯†ç  (ç”¨äºéªŒè¯èº«ä»½)</label>
                        <input type="password" id="admin-password" placeholder="è¾“å…¥ç®¡ç†å¯†ç ">
                        <p style="font-size: 0.85rem; color: var(--text-light); margin-top: 5px;">
                            æ­¤å¯†ç ç”¨äºæ‰€æœ‰æ•æ„Ÿæ“ä½œçš„éªŒè¯ã€‚
                        </p>
                    </div>

                    <div class="form-group" style="margin-top: 20px; border-top: 1px solid #eee; padding-top: 20px;">
                        <label>è¿è¡Œæ¨¡å¼</label>
                        <select id="mock-mode">
                            <option value="true">Mock æ¨¡å¼ (æ— éœ€ Keyï¼Œæ¨¡æ‹Ÿç”Ÿæˆ)</option>
                            <option value="false">å®æˆ˜æ¨¡å¼ (è°ƒç”¨çœŸå® API)</option>
                        </select>
                    </div>

                    <h3 style="margin-top: 20px; margin-bottom: 10px; font-size: 1.1rem; border-left: 4px solid #ff4757; padding-left: 10px;">NanoPro (æ–‡ç”Ÿå›¾)</h3>
                    <div class="form-group">
                        <label>API Key</label>
                        <input type="password" id="image-key" placeholder="sk-...">
                        <label style="margin-top: 8px; font-size: 0.85rem; color: #64748b;">API Base URL (é»˜è®¤ä¸º OpenAI DALL-E 3)</label>
                        <input type="text" id="image-url" placeholder="https://api.openai.com/v1/images/generations">
                    </div>

                    <h3 style="margin-top: 20px; margin-bottom: 10px; font-size: 1.1rem; border-left: 4px solid #ff4757; padding-left: 10px;">Sora2 (è§†é¢‘)</h3>
                    <div class="form-group">
                        <label>API Key</label>
                        <input type="password" id="sora-key" placeholder="sk-...">
                        <label style="margin-top: 8px; font-size: 0.85rem; color: #64748b;">API Base URL</label>
                        <input type="text" id="sora-url" placeholder="https://api.example.com/v1/video">
                    </div>

                    <h3 style="margin-top: 20px; margin-bottom: 10px; font-size: 1.1rem; border-left: 4px solid #ff4757; padding-left: 10px;">Veo (è§†é¢‘)</h3>
                    <div class="form-group">
                        <label>API Key</label>
                        <input type="password" id="veo-key" placeholder="sk-...">
                        <label style="margin-top: 8px; font-size: 0.85rem; color: #64748b;">API Base URL</label>
                        <input type="text" id="veo-url" placeholder="https://api.example.com/v1/video">
                    </div>

                    <h3 style="margin-top: 20px; margin-bottom: 10px; font-size: 1.1rem; border-left: 4px solid #ff4757; padding-left: 10px;">Suno (éŸ³ä¹)</h3>
                    <div class="form-group">
                        <label>API Key</label>
                        <input type="password" id="suno-key" placeholder="sk-...">
                        <label style="margin-top: 8px; font-size: 0.85rem; color: #64748b;">API Base URL</label>
                        <input type="text" id="suno-url" placeholder="https://api.example.com/v1/music">
                    </div>

                    <h3 style="margin-top: 20px; margin-bottom: 10px; font-size: 1.1rem; border-left: 4px solid #ff4757; padding-left: 10px;">HeyGen (æ•°å­—äºº)</h3>
                    <div class="form-group">
                        <label>API Key</label>
                        <input type="password" id="heygem-key" placeholder="sk-...">
                        <label style="margin-top: 8px; font-size: 0.85rem; color: #64748b;">API Base URL</label>
                        <input type="text" id="heygem-url" placeholder="https://api.example.com/v1/avatar">
                    </div>

                    <button class="primary-btn" style="margin-top: 30px;" onclick="saveAdminConfig()">ä¿å­˜é…ç½®</button>
                </div>
            </div>

        </div>
        
        <!-- Modal for Add/Edit Template -->
        <div id="template-modal" class="modal" style="display:none; position:fixed; top:0; left:0; width:100%; height:100%; background:rgba(0,0,0,0.5); z-index:1000; align-items:center; justify-content:center;">
            <div class="modal-content" style="background:white; padding:2rem; border-radius:12px; width:500px; max-width:90%;">
                <h2 id="modal-title" style="margin-bottom:1rem;">æ–°å¢æ¨¡æ¿</h2>
                <input type="hidden" id="tpl-id">
                <div class="form-group">
                    <label>æ¨¡æ¿åç§°</label>
                    <input type="text" id="tpl-name" placeholder="ä¾‹å¦‚: è¿ç¯è¡¨æƒ…åŒ…">
                </div>
                <div class="form-group" style="margin-top:1rem;">
                    <label>åˆ†ç±»</label>
                    <select id="tpl-category">
                        <option value="general">é€šç”¨</option>
                        <option value="character">è§’è‰²</option>
                        <option value="commercial">å•†ä¸š</option>
                        <option value="style">é£æ ¼</option>
                    </select>
                </div>
                <div class="form-group" style="margin-top:1rem;">
                    <label>æç¤ºè¯å†…å®¹</label>
                    <textarea id="tpl-content" rows="5" style="width:100%; padding:10px; border:1px solid #ddd; border-radius:6px;" placeholder="è¾“å…¥å…·ä½“çš„æç¤ºè¯å†…å®¹..."></textarea>
                </div>
                <div class="form-group" style="margin-top:1rem;">
                    <label>çŠ¶æ€</label>
                    <select id="tpl-active">
                        <option value="true">å¯ç”¨</option>
                        <option value="false">ç¦ç”¨</option>
                    </select>
                </div>
                <div style="display:flex; justify-content:flex-end; gap:10px; margin-top:2rem;">
                    <button class="secondary-btn" onclick="closeTemplateModal()">å–æ¶ˆ</button>
                    <button class="primary-btn" onclick="saveTemplate()">ä¿å­˜</button>
                </div>
            </div>
        </div>
    </div>

    <script>
        // Tab Switching
        function switchTab(tabId) {
            // Update nav items
            document.querySelectorAll('.nav-item').forEach(item => {
                item.classList.remove('active');
            });
            event.target.classList.add('active');

            // Update content
            document.querySelectorAll('.tab-content').forEach(content => {
                content.classList.remove('active');
            });
            document.getElementById(`tab-${tabId}`).classList.add('active');

            // Load data if needed
            if (tabId === 'users') loadUsers();
            if (tabId === 'pricing') loadPricing();
            if (tabId === 'api') loadApiConfig();
            if (tabId === 'templates') loadTemplates();
        }

        // Auth / Config
        function getAdminPassword() {
            return localStorage.getItem('admin_password') || '';
        }

        async function loadApiConfig() {
            const pwd = getAdminPassword();
            if (!pwd) return;

            try {
                const res = await fetch(`/api/admin/config?password=${pwd}`);
                if (res.ok) {
                    const config = await res.json();
                    document.getElementById('mock-mode').value = config.mock_mode.toString();
                    document.getElementById('sora-key').value = config.sora_api_key || '';
                    document.getElementById('sora-url').value = config.sora_api_url || '';
                    document.getElementById('veo-key').value = config.veo_api_key || '';
                    document.getElementById('veo-url').value = config.veo_api_url || '';
                    document.getElementById('suno-key').value = config.suno_api_key || '';
                    document.getElementById('suno-url').value = config.suno_api_url || '';
                    document.getElementById('heygem-key').value = config.heygem_api_key || '';
                    document.getElementById('heygem-url').value = config.heygem_api_url || '';
                    document.getElementById('image-key').value = config.image_api_key || '';
                    document.getElementById('image-url').value = config.image_api_url || '';
                }
            } catch (e) {
                console.error('Failed to load config', e);
            }
        }

        async function saveAdminConfig() {
            const pwd = document.getElementById('admin-password').value;
            if (!pwd) {
                alert('è¯·è¾“å…¥ç®¡ç†å¯†ç ');
                return;
            }

            // Save locally for auth
            localStorage.setItem('admin_password', pwd);

            // Save to server
            const data = {
                password: pwd,
                mock_mode: document.getElementById('mock-mode').value === 'true',
                sora_api_key: document.getElementById('sora-key').value,
                sora_api_url: document.getElementById('sora-url').value,
                veo_api_key: document.getElementById('veo-key').value,
                veo_api_url: document.getElementById('veo-url').value,
                suno_api_key: document.getElementById('suno-key').value,
                suno_api_url: document.getElementById('suno-url').value,
                heygem_api_key: document.getElementById('heygem-key').value,
                heygem_api_url: document.getElementById('heygem-url').value,
                image_api_key: document.getElementById('image-key').value,
                image_api_url: document.getElementById('image-url').value
            };

            try {
                const res = await fetch('/api/admin/config', {
                    method: 'POST',
                    headers: {'Content-Type': 'application/json'},
                    body: JSON.stringify(data)
                });

                if (res.ok) {
                    alert('é…ç½®å·²ä¿å­˜');
                    loadUsers(); // Try to load users to test password
                } else {
                    alert('ä¿å­˜å¤±è´¥ï¼Œè¯·æ£€æŸ¥å¯†ç ');
                }
            } catch (e) {
                alert('ç½‘ç»œé”™è¯¯');
            }
        }

        function logout() {
            localStorage.removeItem('admin_password');
            window.location.href = '/';
        }

        // Initialize
        document.addEventListener('DOMContentLoaded', () => {
            const savedPwd = localStorage.getItem('admin_password');
            if (savedPwd) {
                document.getElementById('admin-password').value = savedPwd;
                loadUsers();
                loadPricing();
            } else {
                switchTab('api'); // Force to API tab if no password
            }
        });

        // --- Users Logic ---
        async function loadUsers() {
            const pwd = getAdminPassword();
            if (!pwd) return;

            try {
                const res = await fetch(`/api/admin/users?password=${pwd}`);
                if (res.status === 401) {
                    alert('å¯†ç é”™è¯¯æˆ–æœªæˆæƒ');
                    switchTab('api');
                    return;
                }
                const users = await res.json();
                renderUsers(users);
            } catch (e) {
                console.error('Failed to load users', e);
            }
        }

        function renderUsers(users) {
            const tbody = document.getElementById('users-list');
            tbody.innerHTML = '';
            
            users.forEach(user => {
                const tr = document.createElement('tr');
                tr.innerHTML = `
                    <td>#${user.id}</td>
                    <td><strong>${user.username}</strong></td>
                    <td>${user.email || '-'}</td>
                    <td><span style="color: #ff4757; font-weight: bold;">${user.balance.toFixed(1)}</span></td>
                    <td>${user.is_active ? '<span style="color:green">â— æ­£å¸¸</span>' : '<span style="color:red">â— ç¦ç”¨</span>'}</td>
                    <td>
                        <button class="secondary-btn btn-small" onclick="editBalance(${user.id}, '${user.username}', ${user.balance})">âœï¸ ä¿®æ”¹ä½™é¢</button>
                    </td>
                `;
                tbody.appendChild(tr);
            });
        }

        async function editBalance(userId, username, currentBalance) {
            const pwd = getAdminPassword();
            const newAmount = prompt(`ä¿®æ”¹ç”¨æˆ· ${username} çš„ä½™é¢\nå½“å‰ä½™é¢: ${currentBalance}`, currentBalance);
            
            if (newAmount === null) return; // Cancelled
            const amount = parseFloat(newAmount);
            if (isNaN(amount)) {
                alert('è¯·è¾“å…¥æœ‰æ•ˆçš„æ•°å­—');
                return;
            }

            try {
                const res = await fetch(`/api/admin/users/${userId}/balance`, {
                    method: 'POST',
                    headers: {'Content-Type': 'application/json'},
                    body: JSON.stringify({ password: pwd, amount: amount })
                });
                
                if (res.ok) {
                    alert('ä¿®æ”¹æˆåŠŸ');
                    loadUsers();
                } else {
                    const err = await res.json();
                    alert('ä¿®æ”¹å¤±è´¥: ' + err.detail);
                }
            } catch (e) {
                alert('ç½‘ç»œé”™è¯¯');
            }
        }

        // --- Pricing Logic ---
        async function loadPricing() {
            const pwd = getAdminPassword();
            if (!pwd) return;

            try {
                const res = await fetch(`/api/admin/pricing?password=${pwd}`);
                if (res.ok) {
                    const pricing = await res.json();
                    document.getElementById('price-video').value = pricing.video;
                    document.getElementById('price-image').value = pricing.image;
                    document.getElementById('price-music').value = pricing.music;
                    document.getElementById('price-avatar').value = pricing.avatar;
                }
            } catch (e) {
                console.error('Failed to load pricing', e);
            }
        }

        async function savePricing() {
            const pwd = getAdminPassword();
            if (!pwd) {
                alert('è¯·å…ˆè®¾ç½®ç®¡ç†å¯†ç ');
                switchTab('api');
                return;
            }

            const data = {
                password: pwd,
                video: parseFloat(document.getElementById('price-video').value) || 0,
                image: parseFloat(document.getElementById('price-image').value) || 0,
                music: parseFloat(document.getElementById('price-music').value) || 0,
                avatar: parseFloat(document.getElementById('price-avatar').value) || 0
            };

            try {
                const res = await fetch('/api/admin/pricing', {
                    method: 'POST',
                    headers: {'Content-Type': 'application/json'},
                    body: JSON.stringify(data)
                });

                if (res.ok) {
                    alert('ä»·æ ¼é…ç½®å·²ä¿å­˜');
                } else {
                    alert('ä¿å­˜å¤±è´¥ï¼Œè¯·æ£€æŸ¥å¯†ç ');
                }
            } catch (e) {
                alert('ç½‘ç»œé”™è¯¯');
            }
        }

        // --- Templates Logic ---
        async function loadTemplates() {
            const pwd = getAdminPassword();
            if (!pwd) return;

            try {
                const res = await fetch(`/api/admin/templates?password=${pwd}`);
                if (res.status === 401) {
                    alert('å¯†ç é”™è¯¯æˆ–æœªæˆæƒ');
                    switchTab('api');
                    return;
                }
                const templates = await res.json();
                renderTemplates(templates);
            } catch (e) {
                console.error('Failed to load templates', e);
            }
        }

        function renderTemplates(templates) {
            const tbody = document.getElementById('templates-list');
            tbody.innerHTML = '';
            
            templates.forEach(tpl => {
                const tr = document.createElement('tr');
                tr.innerHTML = `
                    <td>#${tpl.id}</td>
                    <td><strong>${tpl.name}</strong></td>
                    <td><span style="background:#f1f5f9; padding:2px 6px; border-radius:4px; font-size:0.8rem;">${tpl.category}</span></td>
                    <td><div style="max-width:300px; white-space:nowrap; overflow:hidden; text-overflow:ellipsis;" title="${tpl.content}">${tpl.content}</div></td>
                    <td>${tpl.is_active ? '<span style="color:green">â— å¯ç”¨</span>' : '<span style="color:gray">â— ç¦ç”¨</span>'}</td>
                    <td>
                        <button class="secondary-btn btn-small" onclick="openTemplateModal(${tpl.id}, '${tpl.name.replace(/'/g, "\\'")}', '${tpl.category}', '${tpl.content.replace(/'/g, "\\'").replace(/\n/g, "\\n")}', ${tpl.is_active})">âœï¸ ç¼–è¾‘</button>
                        <button class="secondary-btn btn-small" style="color:red; border-color:red;" onclick="deleteTemplate(${tpl.id})">ğŸ—‘ï¸ åˆ é™¤</button>
                    </td>
                `;
                tbody.appendChild(tr);
            });
        }

        function openTemplateModal(id = null, name = '', category = 'general', content = '', active = true) {
            document.getElementById('template-modal').style.display = 'flex';
            document.getElementById('tpl-id').value = id || '';
            document.getElementById('modal-title').textContent = id ? 'ç¼–è¾‘æ¨¡æ¿' : 'æ–°å¢æ¨¡æ¿';
            document.getElementById('tpl-name').value = name;
            document.getElementById('tpl-category').value = category;
            document.getElementById('tpl-content').value = content;
            document.getElementById('tpl-active').value = active.toString();
        }

        function closeTemplateModal() {
            document.getElementById('template-modal').style.display = 'none';
        }

        async function saveTemplate() {
            const pwd = getAdminPassword();
            const id = document.getElementById('tpl-id').value;
            const data = {
                name: document.getElementById('tpl-name').value,
                category: document.getElementById('tpl-category').value,
                content: document.getElementById('tpl-content').value,
                is_active: document.getElementById('tpl-active').value === 'true'
            };

            if (!data.name || !data.content) {
                alert('è¯·å¡«å†™åç§°å’Œå†…å®¹');
                return;
            }

            try {
                let res;
                if (id) {
                    // Update
                    res = await fetch(`/api/admin/templates/${id}?password=${pwd}`, {
                        method: 'PUT',
                        headers: {'Content-Type': 'application/json'},
                        body: JSON.stringify(data)
                    });
                } else {
                    // Create
                    res = await fetch(`/api/admin/templates?password=${pwd}`, {
                        method: 'POST',
                        headers: {'Content-Type': 'application/json'},
                        body: JSON.stringify(data)
                    });
                }

                if (res.ok) {
                    alert('ä¿å­˜æˆåŠŸ');
                    closeTemplateModal();
                    loadTemplates();
                } else {
                    alert('ä¿å­˜å¤±è´¥');
                }
            } catch (e) {
                alert('ç½‘ç»œé”™è¯¯');
            }
        }

        async function deleteTemplate(id) {
            if(!confirm('ç¡®å®šè¦åˆ é™¤è¿™ä¸ªæ¨¡æ¿å—ï¼Ÿ')) return;
            
            const pwd = getAdminPassword();
            try {
                const res = await fetch(`/api/admin/templates/${id}?password=${pwd}`, {
                    method: 'DELETE'
                });
                if (res.ok) {
                    loadTemplates();
                } else {
                    alert('åˆ é™¤å¤±è´¥');
                }
            } catch (e) {
                alert('ç½‘ç»œé”™è¯¯');
            }
        }
    </script>
</body>
</html>