<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>江左盟 - AI 创意工坊</title>
    <link rel="stylesheet" href="/static/style.css">
    <!-- Fabric.js for Canvas -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/fabric.js/5.3.1/fabric.min.js"></script>
</head>
<body>
    <div class="app-container">
        <!-- 顶部导航栏 -->
        <nav class="navbar">
            <div class="logo">
                <span style="font-weight: bold; color: #1e293b;">江左盟</span>
            </div>
            <div class="nav-links">
                <div class="nav-item active" data-tab="image">NanoPro 文生图</div>
                <div class="nav-item" data-tab="canvas">Nano2 画布</div>
                <div class="nav-item" data-tab="video">Sora2 视频</div>
                <div class="nav-item" data-tab="veo">Veo视频</div>
                <div class="nav-item" data-tab="music">Suno音乐</div>
                <div class="nav-item" data-tab="avatar">Heygem数字人</div>
            </div>
            <div class="nav-auth">
                <div id="guest-actions">
                    <button class="btn-auth" onclick="showModal('auth-modal', 'login')">登录</button>
                    <button class="btn-auth btn-primary" onclick="showModal('auth-modal', 'register')">注册</button>
                </div>
                <div id="user-actions" style="display: none;">
                    <span class="user-balance" onclick="showModal('recharge-modal')">💎 <span id="display-balance">0</span></span>
                    <button class="btn-recharge" onclick="showModal('recharge-modal')">充值</button>
                    <span id="display-username" style="margin: 0 10px; font-weight: 600;">User</span>
                    <button class="btn-logout" id="btn-logout">退出</button>
                </div>
            </div>
        </nav>

        <main class="content-wrapper">
            <!-- 1. NanoPro 文生图模块 -->
            <section id="image-section" class="tab-content active">
                <div class="hero-text">
                    <h1>NanoPro 文生图</h1>
                    <p>释放你的想象力，用文字创造惊艳的图像</p>
                </div>
                <div class="input-section">
                    <div class="form-group">
                        <textarea id="image-prompt" placeholder="描述你想生成的图片内容... 例如：一只在太空漫步的赛博朋克猫咪"></textarea>
                    </div>
                    <button id="generateImageBtn" class="primary-btn">生成图片</button>
                </div>
                <div class="result-display" id="image-result">
                    <!-- 结果将在这里显示 -->
                </div>
            </section>

            <!-- 2. Nano2 画布 -->
            <section id="canvas-section" class="tab-content">
                <div class="canvas-container-wrapper">
                    <!-- Left Toolbar -->
                <div class="canvas-toolbar">
                    <div class="tool-btn active" onclick="setCanvasTool('select')" title="选择 (Select)">↖</div>
                    <div class="tool-btn" onclick="setCanvasTool('hand')" title="拖拽 (Pan)">✋</div>
                    <div class="tool-btn" onclick="setCanvasTool('brush')" title="画笔 (Brush)">✏️</div>
                        <div class="tool-btn" onclick="setCanvasTool('rect')" title="矩形 (Rectangle)">⬜</div>
                        <div class="tool-btn" onclick="setCanvasTool('circle')" title="圆形 (Circle)">⭕</div>
                        <div class="tool-btn" onclick="setCanvasTool('text')" title="文字 (Text)">T</div>
                        <div class="tool-btn" onclick="addGenFrame()" title="生成框 (Generation Frame)">✨</div>
                        <div class="tool-btn" onclick="clearCanvas()" title="清空 (Clear)">🗑️</div>
                        <input type="file" id="imgUpload" style="display:none" onchange="handleImageUpload(this)">
                        <div class="tool-btn" onclick="document.getElementById('imgUpload').click()" title="上传图片 (Upload)">📁</div>
                    </div>

                    <!-- Main Canvas Area -->
                    <div id="canvas-wrapper">
                        <canvas id="main-canvas"></canvas>
                    </div>

                    <!-- Floating Generation Panel -->
                    <div class="canvas-gen-panel">
                        <div class="gen-header">
                            <span>✨ AI 生成 (选定区域)</span>
                        </div>
                        <textarea id="canvas-prompt" placeholder="描述你想在选定区域生成的内容..."></textarea>
                        
                        <!-- Template Bar -->
                        <div class="template-bar-container" style="margin: 8px 0;">
                            <div style="display:flex; align-items:center; justify-content:space-between; margin-bottom:5px;">
                                <span style="font-size:0.75rem; color:#64748b;">快捷提示词:</span>
                                <select id="more-templates" onchange="applyTemplate(this.value)" style="font-size:0.75rem; border:1px solid #e2e8f0; border-radius:4px; padding:2px 4px; max-width: 100px;">
                                    <option value="">更多效果...</option>
                                </select>
                            </div>
                            <div id="quick-templates" style="display:flex; gap:6px; flex-wrap:wrap;">
                                <!-- Chips injected by JS -->
                            </div>
                        </div>

                        <div class="gen-actions">
                            <button class="primary-btn" onclick="generateOnCanvas()">生成 / 修改</button>
                        </div>
                    </div>
                </div>
            </section>

            <!-- 3. Sora2 视频模块 (原有的功能) -->
            <section id="video-section" class="tab-content">
                <div class="hero-text">
                    <h1>Sora2 视频生成</h1>
                    <p>输入提示词，体验 AI 视频生成的力量</p>
                </div>
                <div class="input-section">
                    <div class="form-group">
                        <textarea id="video-prompt" placeholder="描述你想生成的视频内容... 例如：一只在赛博朋克城市中飞行的金色巨龙"></textarea>
                    </div>
                    <div class="controls-row">
                        <select id="video-size">
                            <option value="1024x1024">1:1 (1024x1024)</option>
                            <option value="1920x1080">16:9 (1920x1080)</option>
                        </select>
                        <select id="video-duration">
                            <option value="5">5s</option>
                            <option value="10">10s</option>
                        </select>
                    </div>
                    <button id="generateVideoBtn" class="primary-btn">生成视频</button>
                </div>
                <div class="result-display" id="video-result">
                    <!-- 结果将在这里显示 -->
                </div>
            </section>

            <!-- 4. Veo 视频模块 (复用视频逻辑) -->
            <section id="veo-section" class="tab-content">
                <div class="hero-text">
                    <h1>Veo 高清视频</h1>
                    <p>Google Veo 模型，生成更长更流畅的视频</p>
                </div>
                <div class="input-section">
                    <div class="form-group">
                        <textarea id="veo-prompt" placeholder="描述 Veo 视频内容..."></textarea>
                    </div>
                    <button id="generateVeoBtn" class="primary-btn">生成 Veo 视频</button>
                </div>
                <div class="result-display" id="veo-result"></div>
            </section>

            <!-- 5. Suno 音乐模块 -->
            <section id="music-section" class="tab-content">
                <div class="hero-text">
                    <h1>Suno 音乐创作</h1>
                    <p>输入歌词或风格，AI 帮你写歌</p>
                </div>
                <div class="input-section">
                    <div class="form-group">
                        <textarea id="music-prompt" placeholder="描述音乐风格或歌词... 例如：一首欢快的流行歌曲，关于夏天的海滩"></textarea>
                    </div>
                    <button id="generateMusicBtn" class="primary-btn">生成音乐</button>
                </div>
                <div class="result-display" id="music-result"></div>
            </section>

            <!-- 6. Heygem 数字人模块 -->
            <section id="avatar-section" class="tab-content">
                <div class="hero-text">
                    <h1>Heygem 数字人</h1>
                    <p>输入文字，让数字人开口说话</p>
                </div>
                <div class="input-section">
                    <div class="form-group">
                        <textarea id="avatar-text" placeholder="输入你想让数字人说的话..."></textarea>
                    </div>
                    <button id="generateAvatarBtn" class="primary-btn">生成数字人视频</button>
                </div>
                <div class="result-display" id="avatar-result"></div>
            </section>

            <!-- 通用 Loading 提示 -->
            <div id="global-loading" class="loading-overlay hidden">
                <div class="spinner"></div>
                <p>AI 正在全力生成中...</p>
            </div>

        </main>
    </div>

    <!-- 登录/注册弹窗 -->
    <div id="auth-modal" class="modal hidden">
        <div class="modal-content">
            <span class="close-modal" onclick="closeModal('auth-modal')">&times;</span>
            <h2 id="auth-title">登录</h2>
            <form id="auth-form">
                <div class="form-group">
                    <label>用户名</label>
                    <input type="text" id="auth-username" required placeholder="请输入用户名">
                </div>
                <div class="form-group">
                    <label for="auth-password">密码</label>
                    <input type="password" id="auth-password" placeholder="请输入密码" required maxlength="50">
                </div>
                <div class="form-group hidden" id="email-group">
                    <label>邮箱 (可选)</label>
                    <input type="email" id="auth-email" placeholder="用于找回密码">
                </div>
                <button type="submit" class="primary-btn full-width" id="btn-auth-submit">登录</button>
            </form>
            <p class="auth-switch" style="text-align: center; margin-top: 15px; font-size: 14px;">
                <span id="auth-switch-text">还没有账号？</span> 
                <a href="#" id="auth-switch-link" style="color: #ff4757;">去注册</a>
            </p>
        </div>
    </div>

    <!-- 充值弹窗 -->
    <div id="recharge-modal" class="modal hidden">
        <div class="modal-content large">
            <span class="close-modal" onclick="closeModal('recharge-modal')">&times;</span>
            <h2 style="text-align: center; margin-bottom: 20px;">💰 购买算力</h2>
            <div class="pricing-grid">
                <div class="price-card">
                    <h3>基础包</h3>
                    <div class="price">$10</div>
                    <div class="credits">1000 积分</div>
                    <button class="primary-btn" onclick="recharge(10)">购买</button>
                </div>
                <div class="price-card popular">
                    <h3>标准包</h3>
                    <div class="price">$50</div>
                    <div class="credits">5500 积分</div>
                    <div class="tag">最热</div>
                    <button class="primary-btn" onclick="recharge(50)">购买</button>
                </div>
                <div class="price-card">
                    <h3>专业包</h3>
                    <div class="price">$100</div>
                    <div class="credits">12000 积分</div>
                    <button class="primary-btn" onclick="recharge(100)">购买</button>
                </div>
            </div>
            <p style="text-align: center; margin-top: 20px; color: #64748b; font-size: 12px;">* 这是一个演示支付页面，点击购买将直接模拟成功。</p>
        </div>
    </div>

    <!-- 底部版权 -->
    <footer style="text-align: center; margin-top: 50px; color: #64748b; font-size: 14px; padding-bottom: 20px;">
        <p>&copy; 2024 江左盟 AI 创意工坊. All rights reserved.</p>
        <p><a href="/admin" style="color: #94a3b8; text-decoration: none; font-size: 13px; margin-top: 10px; display: inline-block;">管理后台</a></p>
    </footer>

    <script src="/static/script.js"></script>
</body>
</html>